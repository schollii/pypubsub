[tox]
envlist = py37, py38, py39, py310, py311, py312, py313, py314
skip_missing_interpreters = true

[testenv]
description = Run tests with coverage
package = wheel
changedir = tests/suite
setenv =
    UV_CACHE_DIR = {envdir}/.uv-cache
    UV_NO_SYNC = 1
deps =
    pytest
    pytest-cov
commands = python -m pytest --cov=pubsub --cov-report=term-missing {posargs:.}

[testenv:pkg]
description = Build sdist/wheel and validate metadata
skip_install = true
changedir = {toxinidir}
setenv =
    UV_CACHE_DIR = {envdir}/.uv-cache
    UV_NO_SYNC = 1
deps =
    build
    twine
commands =
    python -c "import shutil, pathlib; shutil.rmtree('dist', ignore_errors=True); pathlib.Path('dist').mkdir(exist_ok=True)"
    python -m build
    twine check dist/*
